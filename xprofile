#!/bin/bash

logger -p news.info "Running .xprofile"

LOGIN_CMD="i3"

if [[ -z ${1+x} ]]; then
    logger -p syslog.warn "No login command was found. Falling back to default: ${LOGIN_CMD}"
else
    LOGIN_CMD="${1}"
fi
logger -p news.info "Preparing for session: \"${LOGIN_CMD}\""

# -f "${HOME}/.config/USE_I3"

if [[ "${LOGIN_CMD}" == "i3" ]]; then
    /usr/bin/xscreensaver -nosplash &
    if [[ -e ~/.Xmodmap ]]; then
        logger -p news.info "Xmodmapping..."
        /usr/bin/xmodmap ~/.Xmodmap
    fi

    # use local i3 config, where available
    if [[ ! -f "${HOME}/config/i3/merge_config.sh" ]]; then
        logger -p syslog.warning "Cannot find merge script for i3 config"
    else
        bash "${HOME}/config/i3/merge_config.sh"
    fi

    # composite manager
    if [[ -f /usr/bin/compton ]]; then
        /usr/bin/compton -b
    fi

    #wallpaper
    if [[ -f "${HOME}/.fehbg" ]]; then
        sh "${HOME}/.fehbg"
    fi
elif [[ "${LOGIN_CMD}" == "sway" ]]; then
    QT_QPA_PLATFORM="wayland"
fi

#local changes
if [[ -f "${HOME}/.xprofile.local" ]]; then
    source "${HOME}/.xprofile.local"
fi
